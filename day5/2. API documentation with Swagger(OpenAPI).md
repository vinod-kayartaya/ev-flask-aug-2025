# API Documentation with Swagger/OpenAPI in Flask

When building REST APIs, it’s not enough to just create endpoints — you also need to **document them clearly** so that developers (and even future you) know how to use them.

That’s where **Swagger / OpenAPI** comes in. It allows you to:

- Describe your API endpoints
- Specify request/response formats
- Provide a UI to test APIs interactively

In Flask, one of the easiest ways to integrate Swagger is with **Flasgger**.

---

## 1. What is Flasgger?

[Flasgger](https://github.com/flasgger/flasgger) is a Flask extension that:

- Reads OpenAPI/Swagger specs (YAML or JSON)
- Automatically generates a **Swagger UI** (interactive documentation)
- Lets you add documentation inline in your Flask routes

So, you write your APIs as usual, then just **annotate them with docstrings**, and Flasgger builds the documentation page.

---

## 2. Installing Dependencies

Install the required packages:

```bash
pip install flask flask-sqlalchemy flasgger
```

---

## 3. Project Structure

We’ll keep it simple:

```
flask-swagger-demo/
│
├── app.py
├── extensions.py
├── models.py
└── customers/
    ├── __init__.py
    └── routes.py
```

---

## 4. Setting Up Flasgger

In `app.py`:

```python
from flask import Flask
from config import Config
from extensions import db
from customers.routes import customers_bp
from flasgger import Swagger

def create_app():
    app = Flask(__name__)
    app.config.from_object(Config)

    db.init_app(app)

    # Register blueprints
    app.register_blueprint(customers_bp)

    # Initialize Swagger
    swagger = Swagger(app)

    with app.app_context():
        db.create_all()

    return app

if __name__ == "__main__":
    app = create_app()
    app.run(debug=True)
```

Now, when you run the app and visit **[http://127.0.0.1:5000/apidocs/](http://127.0.0.1:5000/apidocs/)**, you’ll see a Swagger UI (though empty for now).

---

## 5. Adding Swagger Docs to Endpoints

Let’s document the **Customer API**.

In `customers/routes.py`:

```python
from flask import Blueprint, request, jsonify
from extensions import db
from models import Customer
from flasgger.utils import swag_from

customers_bp = Blueprint("customers", __name__, url_prefix="/api/customers")


@customers_bp.route("/", methods=["POST"])
@swag_from({
    "tags": ["Customers"],
    "description": "Create a new customer",
    "parameters": [
        {
            "name": "body",
            "in": "body",
            "required": True,
            "schema": {
                "type": "object",
                "properties": {
                    "name": {"type": "string"},
                    "city": {"type": "string"},
                    "email": {"type": "string"},
                    "phone": {"type": "string"},
                },
                "required": ["name", "email", "phone"]
            }
        }
    ],
    "responses": {
        201: {
            "description": "Customer created successfully",
            "examples": {
                "application/json": {
                    "id": 1,
                    "name": "Vinod",
                    "city": "Bangalore",
                    "email": "vinod@vinod.co",
                    "phone": "9731424784"
                }
            }
        },
        400: {"description": "Validation error"},
        409: {"description": "Email already exists"}
    }
})
def create_customer():
    """Endpoint to create a customer"""
    data = request.json
    name, city, email, phone = data.get("name"), data.get("city"), data.get("email"), data.get("phone")

    if not (name and email and phone):
        return jsonify({"error": "name, email, phone are required"}), 400

    if Customer.query.filter_by(email=email).first():
        return jsonify({"error": "email already exists"}), 409

    customer = Customer(name=name, city=city, email=email, phone=phone)
    db.session.add(customer)
    db.session.commit()

    return jsonify(customer.to_dict()), 201


@customers_bp.route("/", methods=["GET"])
@swag_from({
    "tags": ["Customers"],
    "description": "List all customers",
    "responses": {
        200: {
            "description": "A list of customers",
            "examples": {
                "application/json": [
                    {
                        "id": 1,
                        "name": "Vinod",
                        "city": "Bangalore",
                        "email": "vinod@vinod.co",
                        "phone": "9731424784"
                    }
                ]
            }
        }
    }
})
def list_customers():
    """Endpoint to list customers"""
    customers = Customer.query.all()
    return jsonify([c.to_dict() for c in customers])
```

**Concepts here:**

- `@swag_from({...})` → Inline YAML/JSON definition for the route.
- `"tags"` → Group APIs by category (e.g., “Customers”).
- `"parameters"` → Define inputs (query params, body, headers, etc.).
- `"responses"` → Define possible status codes and example responses.

---

## 6. Trying It Out

Run the app:

```bash
python app.py
```

Open **[http://127.0.0.1:5000/apidocs/](http://127.0.0.1:5000/apidocs/)**.
You’ll now see:

- A **“Customers”** section
- `POST /api/customers/` with request body schema
- `GET /api/customers/` with example responses

You can **try out APIs directly from Swagger UI** — super useful for testing and demos!

---

## 7. Testing with Sample Data (Vinod)

Try the **POST /api/customers/** endpoint in Swagger UI with:

```json
{
  "name": "Vinod",
  "city": "Bangalore",
  "email": "vinod@vinod.co",
  "phone": "9731424784"
}
```

Then use **GET /api/customers/** → You’ll see the saved customer listed.

---

## 8. Benefits of Swagger/OpenAPI

- **Interactive docs**: Consumers can test APIs directly.
- **Clear contract**: Defines inputs, outputs, and errors.
- **Client code generation**: Tools can auto-generate API clients in Python, Java, JS, etc.
- **Team collaboration**: Frontend/backend teams can work in parallel with agreed contracts.

---

## 9. Full Example Code (for reference)

**app.py**

```python
from flask import Flask
from config import Config
from extensions import db
from customers.routes import customers_bp
from flasgger import Swagger

def create_app():
    app = Flask(__name__)
    app.config.from_object(Config)

    db.init_app(app)
    app.register_blueprint(customers_bp)

    swagger = Swagger(app)

    with app.app_context():
        db.create_all()

    return app

if __name__ == "__main__":
    app = create_app()
    app.run(debug=True)
```

**customers/routes.py** → (as shown above with `@swag_from`)

**models.py**

```python
from extensions import db

class Customer(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(120), nullable=False)
    city = db.Column(db.String(120))
    email = db.Column(db.String(120), unique=True, nullable=False)
    phone = db.Column(db.String(20), unique=True, nullable=False)

    def to_dict(self):
        return {
            "id": self.id,
            "name": self.name,
            "city": self.city,
            "email": self.email,
            "phone": self.phone
        }
```

**extensions.py**

```python
from flask_sqlalchemy import SQLAlchemy
db = SQLAlchemy()
```

**config.py**

```python
class Config:
    SQLALCHEMY_DATABASE_URI = "sqlite:///app.db"
    SQLALCHEMY_TRACK_MODIFICATIONS = False
    SECRET_KEY = "dev"
```

---

## 10. Summary

- Swagger/OpenAPI is essential for documenting REST APIs.
- With **Flasgger**, you can add docs using decorators and YAML/JSON definitions.
- The result is a **beautiful interactive API explorer** at `/apidocs/`.
- This improves developer experience and accelerates adoption of your API.
