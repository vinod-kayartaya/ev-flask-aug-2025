# CORS Handling in Flask with Flask-CORS

When you build **REST APIs with Flask**, chances are you‚Äôll need to serve requests from **different domains** ‚Äî like a **React frontend (localhost:3000)** calling a **Flask backend (localhost:5000)**.

By default, browsers **block cross-origin requests** for security reasons. This is known as the **Same-Origin Policy (SOP)**.

To solve this, we use **CORS (Cross-Origin Resource Sharing)**.

In this tutorial, we‚Äôll cover:

- What CORS is and why it matters
- How Flask-CORS works
- Applying CORS globally vs per-route
- Configuring allowed origins, headers, and methods
- Handling preflight (`OPTIONS`) requests
- Example: **E-commerce product API (Indian products)**

---

## Part 1: What is CORS?

- **Same-Origin Policy** ‚Üí A web app can only call APIs from the _same_ domain/port.
- **CORS** ‚Üí A mechanism that tells browsers _which cross-origin requests are allowed_.

Example:

- React frontend at `http://localhost:3000`
- Flask API at `http://localhost:5000`

Without CORS ‚Üí Request is blocked.
With CORS ‚Üí Flask responds with headers like:

```http
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Methods: GET, POST
Access-Control-Allow-Headers: Content-Type, Authorization
```

---

## Part 2: Install Flask-CORS

```bash
pip install flask flask-restful flask-cors
```

---

## Part 3: Basic Flask App

**app.py**

```python
from flask import Flask, jsonify
from flask_restful import Api, Resource
from flask_cors import CORS

app = Flask(__name__)
api = Api(app)

# Enable CORS globally
CORS(app)

products = [
    {"id": 1, "name": "Amul Butter", "price": 50},
    {"id": 2, "name": "Tata Tea", "price": 200},
    {"id": 3, "name": "Parle-G Biscuits", "price": 10},
]

class ProductList(Resource):
    def get(self):
        return jsonify(products)

api.add_resource(ProductList, "/products")

if __name__ == "__main__":
    app.run(debug=True)
```

Now, **any frontend** (React, Angular, Vue) can call `/products`.

---

## Part 4: Restricting CORS to Specific Origins

Allow **only React frontend** (localhost:3000):

```python
CORS(app, resources={r"/products/*": {"origins": "http://localhost:3000"}})
```

---

## Part 5: Applying CORS Per-Route

Instead of applying globally:

```python
from flask_cors import cross_origin

class ProductDetail(Resource):
    @cross_origin(origins="http://localhost:3000")
    def get(self, product_id):
        product = next((p for p in products if p["id"] == product_id), None)
        if product:
            return jsonify(product)
        return {"error": "Product not found"}, 404

api.add_resource(ProductDetail, "/products/<int:product_id>")
```

---

## Part 6: Handling Custom Headers & Methods

Allow **Authorization headers & PUT method**:

```python
CORS(app, resources={r"/products/*": {
    "origins": "http://localhost:3000",
    "methods": ["GET", "POST", "PUT"],
    "allow_headers": ["Content-Type", "Authorization"]
}})
```

This lets the frontend send `Authorization: Bearer <token>` headers.

---

## Part 7: Preflight Requests (OPTIONS)

Browsers send an **OPTIONS** request before `POST/PUT/DELETE`. Flask-CORS handles this automatically, returning:

```http
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type, Authorization
```

Without Flask-CORS, you‚Äôd have to manually handle `OPTIONS`.

---

## Part 8: Example: React Calling Flask API

React fetch call:

```javascript
fetch('http://localhost:5000/products', {
  method: 'GET',
  headers: {
    'Content-Type': 'application/json',
  },
})
  .then((res) => res.json())
  .then((data) => console.log(data));
```

With Flask-CORS ‚Üí Works üéâ
Without Flask-CORS ‚Üí Browser blocks request ‚ùå

---

## Part 9: Security Best Practices

- **Don‚Äôt use `CORS(app)` blindly** in production ‚Üí restrict origins.
- Allow only **specific domains** (your frontend, mobile apps).
- Limit **methods** (e.g., allow `GET, POST` but not `DELETE`).
- Limit **headers** (e.g., allow `Content-Type, Authorization`).

---

## Conclusion

We‚Äôve learned how to:
‚úÖ Understand CORS & Same-Origin Policy
‚úÖ Enable CORS globally with Flask-CORS
‚úÖ Restrict origins, methods, and headers
‚úÖ Handle preflight requests automatically
‚úÖ Secure CORS in production

With these techniques, your Flask APIs can safely serve requests from **different domains and frontends** üöÄ
