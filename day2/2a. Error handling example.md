# Global error handling example

## Flask App (with `abort()` for errors)

```python
from flask import Flask, request, jsonify, abort
from email_validator import validate_email, EmailNotValidError

app = Flask(__name__)

# In-memory users list
users = [
    {"name": "Vinod", "email": "vinod@vinod.co"},
    {"name": "Shyam", "email": "shyam@xmpl.com"}
]

# -------------------------------
# Routes
# -------------------------------

@app.route("/users", methods=["POST"])
def add_user():
    """Add a new user after validation"""
    data = request.get_json()

    if not data or "name" not in data or "email" not in data:
        abort(400, description="Name and email are required")

    try:
        validate_email(data["email"])
    except EmailNotValidError:
        abort(400, description="Invalid email format")

    new_user = {"name": data["name"], "email": data["email"]}
    users.append(new_user)
    return jsonify({"message": "User added", "user": new_user}), 201


@app.route("/users/<string:name>", methods=["GET"])
def get_user(name):
    """Fetch a user by name"""
    for user in users:
        if user["name"].lower() == name.lower():
            return jsonify(user)

    abort(404, description=f"User '{name}' not found")


@app.route("/crash", methods=["GET"])
def crash_app():
    """Force a crash to test 500 handler"""
    abort(500, description="Forced server crash for testing")


# -------------------------------
# Global Error Handlers
# -------------------------------

@app.errorhandler(400)
def handle_bad_request(error):
    return jsonify({
        "status": 400,
        "error": "Bad Request",
        "message": error.description
    }), 400


@app.errorhandler(404)
def handle_not_found(error):
    return jsonify({
        "status": 404,
        "error": "Resource Not Found",
        "message": error.description
    }), 404


@app.errorhandler(500)
def handle_internal_error(error):
    return jsonify({
        "status": 500,
        "error": "Internal Server Error",
        "message": error.description or "Something went wrong on the server."
    }), 500


# -------------------------------
# Run Flask app
# -------------------------------
if __name__ == "__main__":
    app.run(debug=True)
```

---

## ðŸ”Ž Behavior

1. **POST with missing fields**

   ```bash
   curl -X POST http://127.0.0.1:5000/users \
   -H "Content-Type: application/json" \
   -d '{"name":"Ravi"}'
   ```

   Response:

   ```json
   {
     "status": 400,
     "error": "Bad Request",
     "message": "Name and email are required"
   }
   ```

2. **GET non-existing user**

   ```bash
   curl http://127.0.0.1:5000/users/Ravi
   ```

   Response:

   ```json
   {
     "status": 404,
     "error": "Resource Not Found",
     "message": "User 'Ravi' not found"
   }
   ```

3. **Crash the server**

   ```bash
   curl http://127.0.0.1:5000/crash
   ```

   Response:

   ```json
   {
     "status": 500,
     "error": "Internal Server Error",
     "message": "Forced server crash for testing"
   }
   ```

---

This way, **all errors go through the global error handlers**, ensuring a consistent JSON response schema across your API ðŸš€.
